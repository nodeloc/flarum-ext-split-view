{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@nodeloc/flarum-ext-split-view/webpack/bootstrap","webpack://@nodeloc/flarum-ext-split-view/webpack/runtime/compat get default export","webpack://@nodeloc/flarum-ext-split-view/webpack/runtime/define property getters","webpack://@nodeloc/flarum-ext-split-view/webpack/runtime/hasOwnProperty shorthand","webpack://@nodeloc/flarum-ext-split-view/external root \"flarum.core.compat['forum/app']\"","webpack://@nodeloc/flarum-ext-split-view/external root \"flarum.core.compat['common/extend']\"","webpack://@nodeloc/flarum-ext-split-view/external root \"flarum.core.compat['forum/states/ComposerState']\"","webpack://@nodeloc/flarum-ext-split-view/external root \"flarum.core.compat['forum/components/ComposerBody']\"","webpack://@nodeloc/flarum-ext-split-view/external root \"flarum.core.compat['forum/components/DiscussionComposer']\"","webpack://@nodeloc/flarum-ext-split-view/external root \"flarum.core.compat['common/components/TextEditor']\"","webpack://@nodeloc/flarum-ext-split-view/external root \"flarum.core.compat['common/components/Button']\"","webpack://@nodeloc/flarum-ext-split-view/external root \"flarum.core.compat['common/components/Tooltip']\"","webpack://@nodeloc/flarum-ext-split-view/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/states/ComposerState'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/ComposerBody'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionComposer'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/TextEditor'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Tooltip'];","import app from 'flarum/forum/app';\r\nimport { extend } from 'flarum/common/extend';\r\nimport ComposerState from 'flarum/forum/states/ComposerState';\r\nimport ComposerBody from 'flarum/forum/components/ComposerBody';\r\nimport DiscussionComposer from 'flarum/forum/components/DiscussionComposer';\r\nimport TextEditor from 'flarum/common/components/TextEditor';\r\nimport Button from 'flarum/common/components/Button';\r\nimport Tooltip from 'flarum/common/components/Tooltip';\r\napp.initializers.add('nodeloc-split-view', () => {\r\n\textend(ComposerState.prototype, 'load', function (_, componentClass) {\r\n\t\tthis.isSplitView = false;\r\n\t});\r\n\r\n\textend(TextEditor.prototype, 'controlItems', function (items) {\r\n\t\titems.add(\r\n\t\t\t'preview',\r\n\t\t\t<Tooltip text={app.translator.trans('core.forum.composer.preview_tooltip')}>\r\n\t\t\t\t<Button icon=\"fas fa-columns\" className=\"Button Button--icon\" onclick={this.attrs.preview} />\r\n\t\t\t</Tooltip>\r\n\t\t);\r\n\t});\r\n\r\n\textend(ComposerBody.prototype, 'headerItems', function (items) {\r\n\t\tif (app.current.get('stream')?.discussion) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\titems.add(\r\n\t\t\t'preview-discussion',\r\n\t\t\t<div\r\n\t\t\t\tclassName={`Split-view Post-body ${app.composer.isSplitView ? '' : 'hidden'}`}\r\n\t\t\t></div>,\r\n\t\t\t50\r\n\t\t);\r\n\t});\r\n\r\n\tDiscussionComposer.prototype.jumpToPreview = function (e) {\r\n\t\tif (!(e instanceof MouseEvent)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.composer.isSplitView = !this.composer.isSplitView;\r\n\r\n\t\tif (this.composer.isSplitView) {\r\n\t\t\tlet previousContent = this.composer.fields.content();\r\n\t\t\ts9e.TextFormatter.preview(\r\n\t\t\t\tthis.composer.fields.content(),\r\n\t\t\t\tthis.$('.Split-view')[0]\r\n\t\t\t);\r\n\t\t\tthis.composerPreviewInterval = setInterval(() => {\r\n\t\t\t\tconst currentContent = this.composer.fields.content();\r\n\t\t\t\tif (currentContent !== previousContent) {\r\n\t\t\t\t\tpreviousContent = currentContent;\r\n\t\t\t\t\ts9e.TextFormatter.preview(\r\n\t\t\t\t\t\tcurrentContent,\r\n\t\t\t\t\t\tthis.$('.Split-view')[0]\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}, 100);\r\n\t\t} else {\r\n\t\t\tclearInterval(this.composerPreviewInterval);\r\n\t\t\tthis.composerPreviewInterval = null;\r\n\t\t}\r\n\t};\r\n\r\n\textend(ComposerBody.prototype, 'oncreate', function () {\r\n\t\tthis.composerPositionInterval = setInterval(function () {\r\n\t\t\tconst $editorContainer = $(\".TextEditor-editorContainer\");\r\n\t\t\tlet $composer = this.$('.ComposerPage');\r\n\t\t\tif (app.composer.position !== \"normal\") {\r\n\t\t\t\tif (app.current?.data?.routeName !== \"composer\") {\r\n\t\t\t\t\t$composer.css(\"padding-bottom\", '');\r\n\t\t\t\t\t$editorContainer.css(\"padding-bottom\", '');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!$composer.length)\r\n\t\t\t\t$composer = this.$('.Composer');\r\n\t\t\tif (app.composer.isSplitView) {\r\n\t\t\t\tconst $textarea = this.$('.TextEditor textarea');\r\n\t\t\t\tconst $splitView = this.$('.Split-view');\r\n\r\n\t\t\t\tif ($editorContainer.offset()) {\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * 计算当前屏幕是否为手机，以及是否有足够的空间在竖向方向上显示预览\r\n\t\t\t\t\t * 手机端界面，composer为非全屏，且屏幕有大于一倍textarea高度剩余，将composer拉长。\r\n\t\t\t\t\t*/\r\n\t\t\t\t\tlet mode = \"normal\";\r\n\t\t\t\t\tconst textareaHeight = $editorContainer.height();\r\n\t\t\t\t\tconst screenHeight = window.innerHeight;\r\n\t\t\t\t\tif (app.screen() === \"phone\") {\r\n\t\t\t\t\t\tconst composerHeight = $(\".ComposerBody\").height();\r\n\t\t\t\t\t\tconst composerPaddingBottomCss = ($editorContainer.css(\"padding-bottom\") || \"0px\");\r\n\t\t\t\t\t\tconst composerPaddingBottom = parseInt(composerPaddingBottomCss.substring(0, composerPaddingBottomCss.length - 2)) || 0;\r\n\t\t\t\t\t\tif (screenHeight - textareaHeight - composerHeight + composerPaddingBottom > 0) {\r\n\t\t\t\t\t\t\tmode = \"vertical\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\tif (mode === \"normal\") {\r\n\t\t\t\t\t\tconst width = parseInt($editorContainer.width() / 2);\r\n\t\t\t\t\t\tconst height = parseInt($editorContainer.height());\r\n\t\t\t\t\t\t$textarea.css({ width });\r\n\t\t\t\t\t\t$composer.css(\"padding-bottom\", '');\r\n\t\t\t\t\t\t$editorContainer.css(\"padding-bottom\", '');\r\n\t\t\t\t\t\t$splitView.removeClass(\"vertical\");\r\n\t\t\t\t\t\t$splitView.css({\r\n\t\t\t\t\t\t\twidth, height,\r\n\t\t\t\t\t\t\ttop: $textarea.offset().top - $composer.offset().top,\r\n\t\t\t\t\t\t\tleft: $textarea.offset().left - $composer.offset().left + $textarea.width(),\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst width = parseInt($editorContainer.width());\r\n\t\t\t\t\t\tconst height = parseInt($editorContainer.height());\r\n\t\t\t\t\t\t$textarea.css({ width });\r\n\t\t\t\t\t\t$composer.css({ paddingBottom: height });\r\n\t\t\t\t\t\t$editorContainer.css({ paddingBottom: height });\r\n\t\t\t\t\t\t$splitView.addClass(\"vertical\");\r\n\t\t\t\t\t\t$splitView.css({\r\n\t\t\t\t\t\t\twidth: $textarea.width(),\r\n\t\t\t\t\t\t\theight: $textarea.height() + 10,\r\n\t\t\t\t\t\t\ttop: $textarea.offset().top - $composer.offset().top + height,\r\n\t\t\t\t\t\t\tleft: $textarea.offset().left - $composer.offset().left,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t$composer.css(\"padding-bottom\", '');\r\n\t\t\t\t$editorContainer.css(\"padding-bottom\", '');\r\n\t\t\t}\r\n\t\t}, 100);\r\n\t});\r\n\r\n\textend(ComposerBody.prototype, 'onremove', function () {\r\n\t\t//该定时器应当被正确移除\r\n\t\tthis.composerPreviewInterval && clearInterval(this.composerPreviewInterval);\r\n\t\tclearInterval(this.composerPositionInterval);\r\n\t})\r\n});\r\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","app","add","extend","ComposerState","_","componentClass","this","isSplitView","TextEditor","items","m","Tooltip","text","trans","Button","icon","className","onclick","attrs","preview","ComposerBody","_app$current$get","discussion","DiscussionComposer","jumpToPreview","e","_this","MouseEvent","composer","previousContent","fields","content","s9e","TextFormatter","$","composerPreviewInterval","setInterval","currentContent","clearInterval","composerPositionInterval","_app$current","$editorContainer","$composer","position","data","routeName","css","length","$textarea","$splitView","offset","mode","textareaHeight","height","screenHeight","window","innerHeight","composerHeight","composerPaddingBottomCss","parseInt","substring","width","removeClass","top","left","paddingBottom","addClass"],"sourceRoot":""}