{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@nodeloc/flarum-ext-split-view/./src/forum/index.js","webpack://@nodeloc/flarum-ext-split-view/external root \"flarum.core.compat['common/components/Button']\"","webpack://@nodeloc/flarum-ext-split-view/external root \"flarum.core.compat['common/components/TextEditor']\"","webpack://@nodeloc/flarum-ext-split-view/external root \"flarum.core.compat['common/components/Tooltip']\"","webpack://@nodeloc/flarum-ext-split-view/external root \"flarum.core.compat['common/extend']\"","webpack://@nodeloc/flarum-ext-split-view/external root \"flarum.core.compat['forum/app']\"","webpack://@nodeloc/flarum-ext-split-view/external root \"flarum.core.compat['forum/components/ComposerBody']\"","webpack://@nodeloc/flarum-ext-split-view/external root \"flarum.core.compat['forum/components/DiscussionComposer']\"","webpack://@nodeloc/flarum-ext-split-view/external root \"flarum.core.compat['forum/states/ComposerState']\"","webpack://@nodeloc/flarum-ext-split-view/webpack/bootstrap","webpack://@nodeloc/flarum-ext-split-view/webpack/runtime/compat get default export","webpack://@nodeloc/flarum-ext-split-view/webpack/runtime/define property getters","webpack://@nodeloc/flarum-ext-split-view/webpack/runtime/hasOwnProperty shorthand","webpack://@nodeloc/flarum-ext-split-view/webpack/runtime/make namespace object"],"sourcesContent":["import app from 'flarum/forum/app';\r\nimport { extend } from 'flarum/common/extend';\r\nimport ComposerState from 'flarum/forum/states/ComposerState';\r\nimport ComposerBody from 'flarum/forum/components/ComposerBody';\r\nimport DiscussionComposer from 'flarum/forum/components/DiscussionComposer';\r\nimport TextEditor from 'flarum/common/components/TextEditor';\r\nimport Button from 'flarum/common/components/Button';\r\nimport Tooltip from 'flarum/common/components/Tooltip';\r\napp.initializers.add('nodeloc-split-view', () => {\r\n\textend(ComposerState.prototype, 'load', function (_, componentClass) {\r\n\t\tthis.isSplitView = false;\r\n\t});\r\n\r\n\textend(TextEditor.prototype, 'controlItems', function (items) {\r\n\t\titems.add(\r\n\t\t\t'preview',\r\n\t\t\t<Tooltip text={app.translator.trans('core.forum.composer.preview_tooltip')}>\r\n\t\t\t\t<Button icon=\"fas fa-columns\" className=\"Button Button--icon\" onclick={this.attrs.preview} />\r\n\t\t\t</Tooltip>\r\n\t\t);\r\n\t});\r\n\r\n\textend(ComposerBody.prototype, 'headerItems', function (items) {\r\n\t\tif (app.current.get('stream')?.discussion) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\titems.add(\r\n\t\t\t'preview-discussion',\r\n\t\t\t<div\r\n\t\t\t\tclassName={`Split-view Post-body ${app.composer.isSplitView ? '' : 'hidden'}`}\r\n\t\t\t></div>,\r\n\t\t\t50\r\n\t\t);\r\n\t});\r\n\r\n\tDiscussionComposer.prototype.jumpToPreview = function (e) {\r\n\t\tif (!(e instanceof MouseEvent)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.composer.isSplitView = !this.composer.isSplitView;\r\n\r\n\t\tif (this.composer.isSplitView) {\r\n\t\t\tlet previousContent = this.composer.fields.content();\r\n\t\t\ts9e.TextFormatter.preview(\r\n\t\t\t\tthis.composer.fields.content(),\r\n\t\t\t\tthis.$('.Split-view')[0]\r\n\t\t\t);\r\n\t\t\tthis.composerPreviewInterval = setInterval(() => {\r\n\t\t\t\tconst currentContent = this.composer.fields.content();\r\n\t\t\t\tif (currentContent !== previousContent) {\r\n\t\t\t\t\tpreviousContent = currentContent;\r\n\t\t\t\t\ts9e.TextFormatter.preview(\r\n\t\t\t\t\t\tcurrentContent,\r\n\t\t\t\t\t\tthis.$('.Split-view')[0]\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}, 100);\r\n\t\t} else {\r\n\t\t\tclearInterval(this.composerPreviewInterval);\r\n\t\t\tthis.composerPreviewInterval = null;\r\n\t\t}\r\n\t};\r\n\r\n\textend(ComposerBody.prototype, 'oncreate', function () {\r\n\t\tthis.composerPositionInterval = setInterval(function () {\r\n\t\t\tif (app.composer.position !== \"normal\") {\r\n\t\t\t\tif (app.current?.data?.routeName !== \"composer\")\r\n\t\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst $editorContainer = $(\".TextEditor-editorContainer\");\r\n\t\t\tlet $composer = this.$('.ComposerPage');\r\n\t\t\tif (!$composer.length)\r\n\t\t\t\t$composer = this.$('.Composer');\r\n\t\t\tif (app.composer.isSplitView) {\r\n\t\t\t\tconst $textarea = this.$('.TextEditor textarea');\r\n\t\t\t\tconst $splitView = this.$('.Split-view');\r\n\r\n\t\t\t\tif ($editorContainer.offset()) {\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * 计算当前屏幕是否为手机，以及是否有足够的空间在竖向方向上显示预览\r\n\t\t\t\t\t * 手机端界面，composer为非全屏，且屏幕有大于一倍textarea高度剩余，将composer拉长。\r\n\t\t\t\t\t*/\r\n\t\t\t\t\tlet mode = \"normal\";\r\n\t\t\t\t\tconst textareaHeight = $editorContainer.height();\r\n\t\t\t\t\tconst screenHeight = window.innerHeight;\r\n\t\t\t\t\tif (app.screen() === \"phone\") {\r\n\t\t\t\t\t\tconst composerHeight = $(\".ComposerBody\").height();\r\n\t\t\t\t\t\tconst composerPaddingBottom = parseInt(($editorContainer.css(\"padding-bottom\") || \"0px\").substring(0, -2)) || 0;\r\n\t\t\t\t\t\tif (screenHeight - textareaHeight - composerHeight + composerPaddingBottom > 0) {\r\n\t\t\t\t\t\t\tmode = \"vertical\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\tif (mode === \"normal\") {\r\n\t\t\t\t\t\tconst width = parseInt($editorContainer.width() / 2);\r\n\t\t\t\t\t\tconst height = parseInt($editorContainer.height());\r\n\t\t\t\t\t\t$textarea.css({ width });\r\n\t\t\t\t\t\t$composer.css(\"padding-bottom\", '');\r\n\t\t\t\t\t\t$editorContainer.css(\"padding-bottom\", '');\r\n\t\t\t\t\t\t$splitView.removeClass(\"vertical\");\r\n\t\t\t\t\t\t$splitView.css({\r\n\t\t\t\t\t\t\twidth, height,\r\n\t\t\t\t\t\t\ttop: $textarea.offset().top - $composer.offset().top,\r\n\t\t\t\t\t\t\tleft: $textarea.offset().left - $composer.offset().left + $textarea.width(),\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst width = parseInt($editorContainer.width());\r\n\t\t\t\t\t\tconst height = parseInt($editorContainer.height());\r\n\t\t\t\t\t\t$textarea.css({ width });\r\n\t\t\t\t\t\t$composer.css({ paddingBottom: height });\r\n\t\t\t\t\t\t$editorContainer.css({ paddingBottom: height });\r\n\t\t\t\t\t\t$splitView.addClass(\"vertical\");\r\n\t\t\t\t\t\t$splitView.css({\r\n\t\t\t\t\t\t\twidth: $textarea.width(),\r\n\t\t\t\t\t\t\theight: $textarea.height() + 10,\r\n\t\t\t\t\t\t\ttop: $textarea.offset().top - $composer.offset().top + height,\r\n\t\t\t\t\t\t\tleft: $textarea.offset().left - $composer.offset().left,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t$composer.css(\"padding-bottom\", '');\r\n\t\t\t\t$editorContainer.css(\"padding-bottom\", '');\r\n\t\t\t}\r\n\t\t}, 100);\r\n\t});\r\n\r\n\textend(ComposerBody.prototype, 'onremove', function () {\r\n\t\t//该定时器应当被正确移除\r\n\t\tthis.composerPreviewInterval && clearInterval(this.composerPreviewInterval);\r\n\t\tclearInterval(this.composerPositionInterval);\r\n\t})\r\n});\r\n","module.exports = flarum.core.compat['common/components/Button'];","module.exports = flarum.core.compat['common/components/TextEditor'];","module.exports = flarum.core.compat['common/components/Tooltip'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['forum/app'];","module.exports = flarum.core.compat['forum/components/ComposerBody'];","module.exports = flarum.core.compat['forum/components/DiscussionComposer'];","module.exports = flarum.core.compat['forum/states/ComposerState'];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"names":["app","extend","ComposerState","ComposerBody","DiscussionComposer","TextEditor","Button","Tooltip","initializers","add","prototype","_","componentClass","isSplitView","items","m","text","translator","trans","icon","className","onclick","attrs","preview","_app$current$get","current","get","discussion","composer","jumpToPreview","e","_this","MouseEvent","previousContent","fields","content","s9e","TextFormatter","$","composerPreviewInterval","setInterval","currentContent","clearInterval","composerPositionInterval","position","_app$current","data","routeName","$editorContainer","$composer","length","$textarea","$splitView","offset","mode","textareaHeight","height","screenHeight","window","innerHeight","screen","composerHeight","composerPaddingBottom","parseInt","css","substring","width","removeClass","top","left","paddingBottom","addClass"],"sourceRoot":""}